# Proves de penetració (Pentesting)

---

## Penetration testing: Introducció

> Prova de penetració

---

## Què és _penetration testing_?

- Les **proves de penetració** avaluen la seguretat intentant activament **trobar vulnerabilitats explotables**
  - Activitat de _**black hat**_ (amb un bon propòsit). Els practicants també s’anomenen _**red teams**_, _**tiger teams**_, etc.
- Es pot aplicar a diferents nivells de granularitat
  - **programa** (procés únic)
  - **sol·licitud completa** (processos de comunicació)
  - **xarxa** de moltes aplicacions
  - generalment no a biblioteques ni fragments de codi incomplets

---

## Qui, i com

- Els _**pen testers**_ utilitzen **enginy** i **eines** **automatitzades**
  - Per explorar ràpidament la superfície d'atac d'un sistema, cercant les debilitats per explotar
- Normalment **duit a terme per un grup separat** dins o fora d'una organització, independent dels desenvolupadors
  - **Evita la visió de túnel**: la mateixa raó per la qual els metges solen no tractar-se a ells mateixos ni a les seves pròpies famílies
- Podem simular **accés variat a les parts internes del sistema**
  - Des de **no tenir accés**, com un atacant extern, fins a l'**accés total**, com una persona interna amb coneixements

---

![Bug bounty](./img/bug-bounty.png)

---

## Beneficis

- Les **penetracions** són **certes** i **reproduïbles**, demostrades per proves
  - **No és hipotètic**
  - **Aplicat** a **tot un component**
    - no a fragments de codi
  - **Sense falses alarmes** (com l’anàlisi estàtic)
- Factor “sentir-se bé”.
  - Produeix **evidències de vulnerabilitats reals** que, d'altra manera, no s'haurien solucionat
  - D'aquesta manera es tradueix en una **clara millora de la seguretat**

---

## Inconvenients

- L'**absència** de **penetracions** **no és una prova de seguretat**
  - Després d'arreglar qualsevol problema, pot haver-hi altres encara a l'aguait
- Els canvis al sistema requereixen una nova prova
  - La seguretat no és compositiva: un canvi a un component pot fer que un altre component sigui insegur
    - Per tant, cal tornar a provar tot el sistema
  - Però els canvis són habituals!
    - Pot ser car tornar a provar amb massa freqüència
- No obstant això, **val la pena fer proves de penetració**

---

## Què veurem?

- Visió general i eines
  - El _pen testing_ és **art** i **ciència**
  - La ciència es plasma en **eines**
  - Considerarem breument:
    - Nmap per a l'exploració de xarxa
    - Proxy web Zap per a sondeig, explotació
    - Metasploit per a l'explotació d'ús general
    - ... i indicacions a més eines
- Tècnica útil: **Fuzzing**
  - Trobar inputs mal manejats
    - on el fracàs implica una bona oportunitat d'explotació

---

## Pen Testing

> Prova de penetració

---

## Què és _pen testing_?

![Pen testing](./img/pen-testing.png)

- _Pen testing_ és tant art com ciència
  - Els humans proven i interactuen amb un sistema, buscant diferents debilitats o vectors d'atac
    - Utilitzant l’intel·ligència, l'adaptació i l'enginy
- Un cop sorgeixen els patrons d'exploració i explotació, es poden fer programes informàtics (eines) per fer el treball
  - Enginy/creativitat automatitzat

---

## Caixa d’eines del _pen tester_

- **Un _pen tester_ s'acosta a un objectiu sabent...**
  - el **funcionament** del domini objectiu (p. ex., el web)
  - .. com **està construït** el sistema en aquest domini
    - **Protocols** (p. ex., HTTP, TCP, ...)
    - **Llenguatges** (p. ex., PHP, Java, Ruby, ...)
    - **Frameworks** (p. ex., Rails, Dream Weaver, Drupal)
  - ... **debilitats comunes** en el programari/sistema
    - **Errors** (p. ex., injeccions SQL, XSS, CSRF, ...)
    - **Configuracions incorrectes, mal disseny** (p. ex., contrasenyes predeterminades, fitxers “ocults”, ...)

---

## _Web hacking_

- Un 70% del problema està als paràmetres
- Si l'URL és `http://tgt.com/buy?item=1&price=5.00`
- A continuació, canvieu-lo a:
  - Els paràmetres del client són de confiança?
    - `/buy?item=1&price=0,01`
    - `/buy?item=10&price=5,00`
  - Susceptible a XSS?
    - `/buy?item=1&price=5.00<script>alert(“test”);</script>`
  - Susceptible a altres injeccions?
    - `/buy?item=1&price=5,00’`

---v

- 10% de contrasenyes predeterminades
  - Busqueu sempre la contrasenya predeterminada i proveu-la
    - Funciona molt més sovint del que et penses
- 10% d'arxius i directoris ocults
  - Busqueu pistes als manuals
  - Força bruta del directori
- 10% altres
  - Problemes d'autenticació (bypass, replay, ...)
  - Serveis web insegurs
  - La pàgina de configuració proporciona la vostra contrasenya de root

---

## Eines

- Hi ha una llista completa a [http://sectools.org/](http://sectools.org/)
- Els pen testers utilitzen eines per
  - **Sondejar** un objectiu
  - **Recollir informació** i **provar** hipòtesis al respecte
  - **Explotar** una vulnerabilitat (o intentar-ho)
- Quina eina utilitzar depèn de l'objectiu
  - Si es tracta d'una **xarxa empresarial**, volem trobar, investigar i explotar màquines, encaminadors, topologia, etc.
  - Si es tracta d'**una única màquina**, volem tenir en compte programari instal·lat, programes en execució, fitxers interessants
  - Si es tracta d'**un sol programa**, volem explorar i explotar possibles entrades i interaccions

---

## _nmap_ per al sondeig de la xarxa

- nmap significa "mapejador de xarxa"
- Per descobrir:
  - quins **hosts** estan disponibles a la xarxa,
  - quins **serveis** (nom i versió de l'aplicació) ofereixen aquests hosts,
  - quins **sistemes operatius** (i versions del sistema operatiu) estan executant,
  - quin tipus de **filtres de paquets/tallafocs** s'utilitzen
  - ... i més
- Funciona enviant **paquets IP raw** (en brut) a la xarxa i **observant-ne els efectes**
- Gratuït, codi obert: [http://nmap.org](http://nmap.org)
